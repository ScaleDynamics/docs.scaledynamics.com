"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[590],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(i,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(h,s(s({ref:t},c),{},{components:n})):a.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[d]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7641:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={slug:"next-js-ssr",title:"Deploy a Next.js SSR application",authors:["clem"],tags:["Next.js","SSR","cloud","ScaleDynamics","deploy"]},s=void 0,l={permalink:"/blog/next-js-ssr",source:"@site/blog/2022-02-10-next-js-srr/index.mdx",title:"Deploy a Next.js SSR application",description:"In this tutorial, we will see how you can deploy a simple server side rendered Next.js application on ScaleDynamics.",date:"2022-02-10T00:00:00.000Z",formattedDate:"February 10, 2022",tags:[{label:"Next.js",permalink:"/blog/tags/next-js"},{label:"SSR",permalink:"/blog/tags/ssr"},{label:"cloud",permalink:"/blog/tags/cloud"},{label:"ScaleDynamics",permalink:"/blog/tags/scale-dynamics"},{label:"deploy",permalink:"/blog/tags/deploy"}],readingTime:6.445,hasTruncateMarker:!0,authors:[{name:"Cl\xe9ment Poisson",title:"Full Stack Engineer @ ScaleDynamics",key:"clem"}],frontMatter:{slug:"next-js-ssr",title:"Deploy a Next.js SSR application",authors:["clem"],tags:["Next.js","SSR","cloud","ScaleDynamics","deploy"]},prevItem:{title:"CI/CD with a simple NestJS server",permalink:"/blog/nest-github-actions"}},i={authorsImageUrls:[void 0]},p=[{value:"Introduction",id:"introduction",level:2},{value:"Goals",id:"goals",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Building the app",id:"building-the-app",level:2},{value:"Account creation and ressource selection",id:"account-creation-and-ressource-selection",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Configuration file",id:"configuration-file",level:3},{value:"Build",id:"build",level:3},{value:"Login",id:"login",level:3},{value:"Deploy",id:"deploy",level:3},{value:"Go further: dedicated resources",id:"go-further-dedicated-resources",level:2},{value:"Next steps",id:"next-steps",level:2}],c={toc:p},d="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In this tutorial, we will see how you can deploy a simple server side rendered Next.js application on ScaleDynamics."),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Next.js is a powerful React framework for building production ready applications that provides built-in features like routing, hot reload, or static generation, that ease the development. In this tutorial we focus on the Server Side Rendering (SSR) feature. Using SSR, the server is in charge of rendering the pages on each request. SSR is ideal for SEO, because search engines can easily index and crawl content because it can be rendered before the page is loaded."),(0,r.kt)("h2",{id:"goals"},"Goals"),(0,r.kt)("p",null,"Our goal is to create a simple Next.js application using SSR and TypeScript, and deploy it using ScaleDynamics cloud platform that provides free cloud resources for testing. We'll learn how simple it is to configure your cloud resource and deploy your application."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"To follow along, you will need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Basic knowledge of Javascript / TypeScript"),(0,r.kt)("li",{parentName:"ul"},"Basic knowledge of ",(0,r.kt)("a",{parentName:"li",href:"https://reactjs.org/"},"React")," and ",(0,r.kt)("a",{parentName:"li",href:"https://nextjs.org/"},"Next.js")),(0,r.kt)("li",{parentName:"ul"},"Node.js and yarn / npm installed. You can go ",(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/en/download/"},"here")," to download the latest version of Node.js and npm.")),(0,r.kt)("h2",{id:"building-the-app"},"Building the app"),(0,r.kt)("p",null,"Let's use ",(0,r.kt)("a",{parentName:"p",href:"https://nextjs.org/docs/api-reference/create-next-app"},"Next.js CLI")," to create an app called ",(0,r.kt)("inlineCode",{parentName:"p"},"next-ssr"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# you can remove --typescript if you want only Javascript\n# just ignore the typing in the following of the tutorial\nyarn create next-app --typescript\n")),(0,r.kt)("p",null,"To fill our app with some fake data, let's install ",(0,r.kt)("a",{parentName:"p",href:"https://axios-http.com/"},(0,r.kt)("inlineCode",{parentName:"a"},"axios"))," to fetch them:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add axios\n")),(0,r.kt)("p",null,"We will use ",(0,r.kt)("a",{parentName:"p",href:"https://jsonplaceholder.typicode.com/"},"JSONPlaceholder")," to provide some fake user data."),(0,r.kt)("p",null,"To activate the SSR, we need to use a specific function called ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerSideProps")," and add it to our main page. So let's rewrite our ",(0,r.kt)("inlineCode",{parentName:"p"},"pages/index.tsx")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'// pages/index.tsx\nimport axios from "axios";\nimport type { GetServerSideProps, NextPage } from "next";\nimport Head from "next/head";\nimport styles from "../styles/Home.module.css";\n\ntype HomeProps = {\n  users: User[];\n};\n\nconst Home = ({ users }: HomeProps): JSX.Element => {\n  return (\n    <div className={styles.container}>\n      <Head>\n        <title>Next SSR with ScaleDynamics</title>\n        <meta name="description" content="Simple SSR app deploy with ScaleDynamics platform" />\n        <link rel="icon" href="/favicon.ico" />\n      </Head>\n\n      <main className={styles.main}>\n        <h1 className={styles.title}>Welcome to my SSR App</h1>\n        <pre>{JSON.stringify(users, null, 2)}</pre>\n      </main>\n    </div>\n  );\n};\n\nexport const getServerSideProps: GetServerSideProps = async () => {\n  const { data } = await axios.get("https://jsonplaceholder.typicode.com/users");\n\n  return {\n    props: {\n      users: data,\n    },\n  };\n};\n\nexport default Home;\n')),(0,r.kt)("p",null,"You will probably get an error from your IDE concerning the type User. Create a folder name ",(0,r.kt)("inlineCode",{parentName:"p"},"domain")," and add a file called ",(0,r.kt)("inlineCode",{parentName:"p"},"user.d.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// domain/user.d.ts\ntype User = {\n  id: number;\n  name: string;\n  username: string;\n  email: string;\n  address: {\n    street: string;\n    suite: string;\n    city: string;\n    zipcode: string;\n    geo: {\n      lat: string;\n      lng: string;\n    };\n  };\n  phone: string;\n  website: string;\n  company: {\n    name: string;\n    catchPhrase: string;\n    bs: string;\n  };\n};\n")),(0,r.kt)("p",null,"Now we can see the result by running the application in dev mode:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn dev\n")),(0,r.kt)("p",null,"You should optain:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"First view",src:n(620).Z,width:"1192",height:"820"})),(0,r.kt)("p",null,"Cool! So now we are fetching data but we are displaying them as JSON data using the ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON.stringify")," function. Let's make that a bit prettier with a component and some css."),(0,r.kt)("p",null,"Create a folder called ",(0,r.kt)("inlineCode",{parentName:"p"},"components")," and two files:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'// components/user.tsx\nimport styles from "./user.module.css";\n\ntype UserProps = {\n  user: User;\n};\n\nconst User = ({ user }: UserProps): JSX.Element => {\n  return (\n    <div className={styles.container}>\n      <div className={styles.infos}>\n        <span>Name: {user.name}</span>\n        <span>Username: {user.username}</span>\n        <span>Email: {user.email}</span>\n        <span>Phone: {user.phone}</span>\n      </div>\n      <div className={styles.address}>\n        <span>Street: {user.address.street}</span>\n        <span>Suit: {user.address.suite}</span>\n        <span>City: {user.address.city}</span>\n        <span>Zipcode: {user.address.zipcode}</span>\n      </div>\n    </div>\n  );\n};\n\nexport default User;\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-css"},"/* user.module.css */\n.container {\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  padding: 0;\n  margin: 0;\n  background-color: #fafafa;\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n  padding: 10px;\n  margin: 10px;\n  width: 500px;\n  max-width: 500px;\n}\n\n.infos {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  padding: 10px;\n  margin: 0;\n  width: 100%;\n}\n\n.address {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  padding: 10px;\n  margin: 0;\n  width: 100%;\n}\n")),(0,r.kt)("p",null,"Now we need to modify our ",(0,r.kt)("inlineCode",{parentName:"p"},"pages/index.tsx")," file to use our brand new component:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'// pages/index.tsx\nimport axios from "axios";\nimport type { GetServerSideProps } from "next";\nimport Head from "next/head";\nimport styles from "../styles/Home.module.css";\nimport User from "../components/user/user";\n\ntype HomeProps = {\n  users: User[];\n};\n\nconst Home = ({ users }: HomeProps): JSX.Element => {\n  const usersDisplay = users.map((user: User): JSX.Element => <User key={user.id} user={user} />);\n\n  return (\n    <div className={styles.container}>\n      <Head>\n        <title>Next SSR with ScaleDynamics</title>\n        <meta name="description" content="Simple SSR app deploy with ScaleDynamics platform" />\n        <link rel="icon" href="/favicon.ico" />\n      </Head>\n\n      <main className={styles.main}>\n        <h1 className={styles.title}>Welcome to my SSR App</h1>\n        {usersDisplay}\n      </main>\n    </div>\n  );\n};\n\nexport const getServerSideProps: GetServerSideProps = async () => {\n  const users = await (await axios.get("https://jsonplaceholder.typicode.com/users")).data;\n\n  return {\n    props: {\n      users,\n    },\n  };\n};\n\nexport default Home;\n')),(0,r.kt)("p",null,"With the dev mode running, the app should look like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Finished view",src:n(9577).Z,width:"1514",height:"1378"})),(0,r.kt)("p",null,"The application is ready, now let's look at the deployment part !"),(0,r.kt)("h2",{id:"account-creation-and-ressource-selection"},"Account creation and ressource selection"),(0,r.kt)("p",null,"To deploy this application on ScaleDynamics's cloud, you need an account and create an environment with a ressource for it. The cloud resource provides virtual CPU and storage capacities used to execute the app. In this tutorial we will use a free shared resource available on ScaleDynamics\u2019s cloud. These are the best one for testing. In this tutorial we will see later how you can upgrade to a dedicated production resource on the public cloud provider and region of your choice."),(0,r.kt)("p",null,"If you don't have an account, feel free to create one ",(0,r.kt)("a",{parentName:"p",href:"https://console.scaledynamics.com/auth/signup/"},"here")," (it's free and no credit card are required). Once your account is created, sign in."),(0,r.kt)("p",null,"Let's create a project and an environment on the ScaleDynamics's ",(0,r.kt)("a",{parentName:"p",href:"https://console.scaledynamics.com"},"console"),". Select your organization, create a new project, then create a new environmnent. Now we need to choose what kind of service we need for our deployment. There are four types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"managed HTTP docker"),(0,r.kt)("li",{parentName:"ul"},"managed Node.js server"),(0,r.kt)("li",{parentName:"ul"},"managed Node.js module"),(0,r.kt)("li",{parentName:"ul"},"static assets hosting")),(0,r.kt)("p",null,"For our Next.js server side rendered, we need a server. Let's pick the managed Node.js server. You can learn more on the other types in the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.scaledynamics.com/"},"ScaleDynamics documentation"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Environment creation",src:n(3172).Z,width:"2610",height:"1504"})),(0,r.kt)("h2",{id:"deployment"},"Deployment"),(0,r.kt)("p",null,"The environment is ready to run our application, let's deploy on it."),(0,r.kt)("h3",{id:"configuration-file"},"Configuration file"),(0,r.kt)("p",null,"First, let's add a configuration to tell the SDK what type of application we want to deploy. At the root of the project, create a ",(0,r.kt)("inlineCode",{parentName:"p"},"warp.config.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// warp.config.js\nmodule.exports = {\n  server: "next-ssr",\n};\n')),(0,r.kt)("h3",{id:"build"},"Build"),(0,r.kt)("p",null,"Build the project to let Next optimize and bundle everything for us:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn build\n")),(0,r.kt)("h3",{id:"login"},"Login"),(0,r.kt)("p",null,"Log into your account and select your organization via the prompt:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npx warp login\n")),(0,r.kt)("h3",{id:"deploy"},"Deploy"),(0,r.kt)("p",null,"Finally, we can run the deployment command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npx warp deploy ./\n")),(0,r.kt)("p",null,"This command will dump something like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Deploy dump",src:n(5357).Z,width:"1366",height:"306"})),(0,r.kt)("p",null,"You can see that a server was detected from your configuration file. Now follow the prompt, select the project you created, then the environment. The prompt will also ask you for a hostname, you can leave it blank for a random name or use the one you want. Finally, you can select a host."),(0,r.kt)("p",null,"The deployment will be done in a few minutes. At the end, the command will dump something like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Deploy end dump",src:n(7390).Z,width:"1346",height:"426"})),(0,r.kt)("p",null,"You can now open your browser and go to the URL and TADA ! Your Next.js application is live !"),(0,r.kt)("h2",{id:"go-further-dedicated-resources"},"Go further: dedicated resources"),(0,r.kt)("p",null,"If you want to use dedicated resources, you can upgrade dynamically to a non shared resource. As shown below it's as simple as a few mouse clicks."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Upgrade to dedicated",src:n(6677).Z,width:"2610",height:"1504"})),(0,r.kt)("h2",{id:"next-steps"},"Next steps"),(0,r.kt)("p",null,"At this stage, you have a fully functional application. You can learn more on the ScaleDynamics ",(0,r.kt)("a",{parentName:"p",href:"https://docs.scaledynamics.com/"},"documentation"),", like how to get the logs of your server, use a custom domain, implement a CI/CD pipeline, etc."),(0,r.kt)("p",null,"Enjoy !"))}u.isMDXComponent=!0},5357:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/deploy-dump-next-4ae1b7ef4517f523a6c895e504817cf7.png"},7390:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/deploy-end-dump-895646245ce0d8a20d26b83a817f4346.png"},9577:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/finished-view-app-817b07e646f0aab46e30ed0ef95935c7.png"},620:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/first-view-app-40984a772ba6fa30f3978527fb956880.png"},3172:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-env-deploy-4a47be049c74e4b720e5b5815e6c1dcc.gif"},6677:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/upgrade-resources-d681d9045259ce1378973bec8f4f0d1c.gif"}}]);